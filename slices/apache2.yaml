package: apache2

essential:
  - apache2_copyright

slices:
  core:
    essential:
      - apache2-bin_bins
      - apache2_config
      - apache2_modules
      - media-types_data
      - procps_bins
    contents:
      /var/log/apache2/access.log: { text: "", mode: 0640 }
      /var/log/apache2/error.log: { text: "", mode: 0640 }
      /var/log/apache2/other_vhosts_access.log: { text: "", mode: 0640 }

  standard:
    essential:
      - apache2-data_data
      - apache2_core
      - apache2_index
      - apache2_scripts

  index:
    # Create default index page in /var/www/html
    # This slice creates an empty index.html and then
    # copies the contents from apache2-data_index slice via mutate
    essential:
      - apache2-data_index
    contents:
      /var/www/html/index.html: { mutable: true, text: "" }
    mutate: |
      src = "/usr/share/apache2/default-site/index.html"
      dst = "/var/www/html/index.html"
      data = content.read(src)
      content.write(dst, data)

  config:
    essential:
      - apache2_vhost-config
    contents:
      # Main configuration file
      /etc/apache2/apache2.conf:

      # Enable default apache2 configs
      /etc/apache2/conf-available/*.conf:
      /etc/apache2/conf-enabled/charset.conf:
        { symlink: /etc/apache2/conf-available/charset.conf }
      /etc/apache2/conf-enabled/localized-error-pages.conf:
        { symlink: /etc/apache2/conf-available/localized-error-pages.conf }
      /etc/apache2/conf-enabled/other-vhosts-access-log.conf:
        { symlink: /etc/apache2/conf-available/other-vhosts-access-log.conf }
      /etc/apache2/conf-enabled/security.conf:
        { symlink: /etc/apache2/conf-available/security.conf }
      /etc/apache2/conf-enabled/serve-cgi-bin.conf:
        { symlink: /etc/apache2/conf-available/serve-cgi-bin.conf }

      # Env, MIME module and ports config
      /etc/apache2/envvars:
      /etc/apache2/magic:
      /etc/apache2/ports.conf:

  vhost-config:
    # Apache2 default virtual host configuration
    # needed for a functional web server
    contents:
      /etc/apache2/sites-available/*.conf:

      # Enable the default site
      /etc/apache2/sites-enabled/000-default.conf:
        { symlink: /etc/apache2/sites-available/000-default.conf }

  modules:
    essential:
      - apache2-bin_libs
    contents:
      /etc/apache2/mods-available/*.conf:
      /etc/apache2/mods-available/*.load:

      # Enable the default modules (maintainer scripts)
      /etc/apache2/mods-enabled/access_compat.load:
        { symlink: /etc/apache2/mods-available/access_compat.load }
      /etc/apache2/mods-enabled/alias.conf:
        { symlink: /etc/apache2/mods-available/alias.conf }
      /etc/apache2/mods-enabled/alias.load:
        { symlink: /etc/apache2/mods-available/alias.load }
      /etc/apache2/mods-enabled/auth_basic.load:
        { symlink: /etc/apache2/mods-available/auth_basic.load }
      /etc/apache2/mods-enabled/authn_file.load:
        { symlink: /etc/apache2/mods-available/authn_file.load }
      /etc/apache2/mods-enabled/authz_core.load:
        { symlink: /etc/apache2/mods-available/authz_core.load }
      /etc/apache2/mods-enabled/authz_host.load:
        { symlink: /etc/apache2/mods-available/authz_host.load }
      /etc/apache2/mods-enabled/authz_user.load:
        { symlink: /etc/apache2/mods-available/authz_user.load }
      /etc/apache2/mods-enabled/autoindex.conf:
        { symlink: /etc/apache2/mods-available/autoindex.conf }
      /etc/apache2/mods-enabled/autoindex.load:
        { symlink: /etc/apache2/mods-available/autoindex.load }
      /etc/apache2/mods-enabled/deflate.conf:
        { symlink: /etc/apache2/mods-available/deflate.conf }
      /etc/apache2/mods-enabled/deflate.load:
        { symlink: /etc/apache2/mods-available/deflate.load }
      /etc/apache2/mods-enabled/dir.conf:
        { symlink: /etc/apache2/mods-available/dir.conf }
      /etc/apache2/mods-enabled/dir.load:
        { symlink: /etc/apache2/mods-available/dir.load }
      /etc/apache2/mods-enabled/env.load:
        { symlink: /etc/apache2/mods-available/env.load }
      /etc/apache2/mods-enabled/filter.load:
        { symlink: /etc/apache2/mods-available/filter.load }
      /etc/apache2/mods-enabled/mime.conf:
        { symlink: /etc/apache2/mods-available/mime.conf }
      /etc/apache2/mods-enabled/mime.load:
        { symlink: /etc/apache2/mods-available/mime.load }
      /etc/apache2/mods-enabled/mpm_event.conf:
        { symlink: /etc/apache2/mods-available/mpm_event.conf }
      /etc/apache2/mods-enabled/mpm_event.load:
        { symlink: /etc/apache2/mods-available/mpm_event.load }
      /etc/apache2/mods-enabled/negotiation.conf:
        { symlink: /etc/apache2/mods-available/negotiation.conf }
      /etc/apache2/mods-enabled/negotiation.load:
        { symlink: /etc/apache2/mods-available/negotiation.load }
      /etc/apache2/mods-enabled/reqtimeout.conf:
        { symlink: /etc/apache2/mods-available/reqtimeout.conf }
      /etc/apache2/mods-enabled/reqtimeout.load:
        { symlink: /etc/apache2/mods-available/reqtimeout.load }
      /etc/apache2/mods-enabled/setenvif.conf:
        { symlink: /etc/apache2/mods-available/setenvif.conf }
      /etc/apache2/mods-enabled/setenvif.load:
        { symlink: /etc/apache2/mods-available/setenvif.load }
      /etc/apache2/mods-enabled/status.conf:
        { symlink: /etc/apache2/mods-available/status.conf }
      /etc/apache2/mods-enabled/status.load:
        { symlink: /etc/apache2/mods-available/status.load }

  scripts:
    essential:
      - apache2_modules
      - coreutils_chmod
      - coreutils_chown
      - coreutils_env
      - coreutils_id-utility
      - coreutils_mkdir
      - coreutils_mktemp
      - coreutils_mv-utility
      - coreutils_readlink
      - coreutils_rm-utility
      - coreutils_rmdir
      - coreutils_stat
      - coreutils_touch
      - dash_bins
      - findutils_bins
      - gawk_bins
      - perl_bins
    contents:
      # Module management scripts
      /usr/sbin/a2disconf:  # Symlink to a2enmod
      /usr/sbin/a2dismod:  # Symlink to a2enmod
      /usr/sbin/a2dissite:  # Symlink to a2enmod
      /usr/sbin/a2enconf:  # Symlink to a2enmod
      /usr/sbin/a2enmod:
      /usr/sbin/a2ensite:  # Symlink to a2enmod
      /usr/sbin/a2query:

      # Control script
      /usr/sbin/apache2ctl:
      /usr/sbin/apachectl:  # Symlink to apache2ctl

  copyright:
    contents:
      /usr/share/doc/apache2/NOTICE:  # Symlink to ../apache2-bin/NOTICE
      /usr/share/doc/apache2/copyright:
