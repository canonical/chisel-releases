package: apt

essential:
  - apt_copyright

slices:
  config:
    contents:
      /etc/apt/apt.conf.d/01-vendor-ubuntu:
      /etc/apt/apt.conf.d/01autoremove:
      /etc/apt/auth.conf.d/:
      /etc/apt/keyrings/:
      /etc/apt/preferences.d/:
      /etc/apt/sources.list.d/:
      /etc/apt/trusted.gpg.d/:

  get-bins:
    essential:
      - apt_config
      - apt_default-source-list
      - apt_get-libs
      - base-files_bin
      - coreutils_bins
      - dpkg_bins
      - libapt-pkg6.0t64_libs
      - libc6_libs
      - libgcc-s1_libs
      - sed_bins
    contents:
      /usr/bin/apt:
      /usr/bin/apt-config:
      /usr/bin/apt-get:
      /usr/bin/apt-key:
      /usr/bin/apt-mark:

  get-libs:
    essential:
      - apt_var
      - gpgv_bins
      - libapt-pkg6.0t64_libs
      - libc6_libs
      - libgcc-s1_libs
      - libgnutls30t64_libs
      - libseccomp2_libs
    contents:
      /usr/lib/*-linux-*/libapt-private.so*:
      /usr/lib/apt/methods/gpgv:
      /usr/lib/apt/methods/http:
      /usr/lib/apt/methods/https:  # Symlink to http
      /usr/lib/apt/methods/store:

  var:
    contents:
      /var/cache/apt/archives/partial/:
      /var/lib/apt/lists/partial/:
      /var/log/apt/:

  # The default source list is generated by the `debootstrap` tool upon the
  # bootstrapping of the root filesystem. This slice provides the content in
  # the generated source list.
  # To provide the architecture-specific source list without conflicts, the
  # ubuntu.sources file is renamed to ubuntu.ports.sources for the ported
  # architectures.
  default-source-list:
    essential:
      - ubuntu-keyring_keys
    contents:
      /etc/apt/sources.list.d/ubuntu.ports.sources:
        arch: [arm64, armhf, ppc64el, riscv64, s390x]
        text: |
          Types: deb
          URIs: http://ports.ubuntu.com/ubuntu-ports/
          Suites: noble noble-updates noble-backports
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

          Types: deb
          URIs: http://ports.ubuntu.com/ubuntu-ports/
          Suites: noble-security
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
      /etc/apt/sources.list.d/ubuntu.sources:
        arch: [amd64, i386]
        text: |
          Types: deb
          URIs: http://archive.ubuntu.com/ubuntu/
          Suites: noble noble-updates noble-backports
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

          Types: deb
          URIs: http://security.ubuntu.com/ubuntu/
          Suites: noble-security
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

  # Placeholder slice contains the script to print the message informing the
  # users about how to install the apt package on minimized systems.
  # A hack leveraging the usrmerge-via-symlink on the paths of apt and apt-get
  # is used to avoid path conflicts.
  placeholder:
    essential:
      - base-files_bin
      - bash_bins
      - coreutils_echo
    contents:
      /bin/apt:
        text: |
          #!/usr/bin/bash
          echo "This system has been minimized by removing packages and content that are"
          echo "not required on a system that users do not log into."
          echo ""
          echo "To restore this content, including apt and dpkg, you can run the command"
          echo "'chisel cut --root / apt_get-bins'"
        mode: 0755
      /bin/apt-get: {symlink: /usr/bin/apt}

  copyright:
    contents:
      /usr/share/doc/apt/copyright:
