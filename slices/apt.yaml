package: apt

essential:
  - apt_copyright

slices:
  config:
    contents:
      /etc/apt/apt.conf.d/01-vendor-ubuntu:
      /etc/apt/apt.conf.d/01autoremove:
      /etc/apt/auth.conf.d/:
      /etc/apt/keyrings/:
      /etc/apt/preferences.d/:
      /etc/apt/sources.list.d/:
      /etc/apt/trusted.gpg.d/:

  apt-get:
    essential:
      - apt_config
      - apt_default-source-list
      - apt_var
      - base-files_bin
      - coreutils_bins
      - dpkg_bins
      - gpgv_bins
      - libapt-pkg6.0t64_libs
      - libc6_libs
      - libgcc-s1_libs
      - libgnutls30t64_libs
      - libseccomp2_libs
      - libstdc++6_libs
      - libsystemd0_libs
      - sed_bins
    contents:
      /usr/bin/apt:
      /usr/bin/apt-config:
      /usr/bin/apt-get:
      /usr/bin/apt-key:
      /usr/bin/apt-mark:
      /usr/lib/*-linux-*/libapt-private.so*:
      /usr/lib/apt/methods/gpgv:
      /usr/lib/apt/methods/http:
      /usr/lib/apt/methods/https:  # Symlink to http
      /usr/lib/apt/methods/store:

  var:
    contents:
      /var/cache/apt/archives/partial/:
      /var/lib/apt/lists/partial/:
      /var/log/apt/:

  # The default source list is generated by the `debootstrap` tool upon the
  # bootstrapping of the root filesystem. This slice provides the content in
  # the generated source list.
  default-source-list:
    essential:
      - ubuntu-keyring_keys
    contents:
      /etc/apt/sources.list.d/ubuntu-default.sources:
        arch: [amd64, i386]
        until: mutate
        text: |
          Types: deb
          URIs: http://archive.ubuntu.com/ubuntu/
          Suites: noble noble-updates noble-backports
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

          Types: deb
          URIs: http://security.ubuntu.com/ubuntu/
          Suites: noble-security
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

      /etc/apt/sources.list.d/ubuntu-ports-default.sources:
        arch: [arm64, armhf, ppc64el, riscv64, s390x]
        until: mutate
        text: |
          Types: deb
          URIs: http://ports.ubuntu.com/ubuntu-ports/
          Suites: noble noble-updates noble-backports
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

          Types: deb
          URIs: http://ports.ubuntu.com/ubuntu-ports/
          Suites: noble-security
          Components: main universe restricted multiverse
          Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

      /etc/apt/sources.list.d/ubuntu.sources: {text: "", mutable: true}

    mutate: |
      files = content.list("/etc/apt/sources.list.d/")
      sources = ""
      for f in ["ubuntu-ports-default.sources", "ubuntu-default.sources"]:
        if f in files:
          sources = content.read("/etc/apt/sources.list.d/" + f)
          break
      content.write("/etc/apt/sources.list.d/ubuntu.sources", sources)

  copyright:
    contents:
      /usr/share/doc/apt/copyright:
