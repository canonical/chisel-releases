package: rabbitmq-server

essential:
  - rabbitmq-server_copyright

# NOTE: erlang* packages do not exist for i386.
# IMPORTANT:the following commented essentials should be manually included when cutting the
# slices for rabbitmq-server on non-i386 systems.
slices:
  autocomplete:
    contents:
      /usr/lib/rabbitmq/autocomplete/*:

  bins:
    essential:
      - base-files_bin
      - base-files_etc
      - base-files_home
      - base-files_var
      - base-passwd_data
      - bash_bins
      - coreutils_bins
      # TODO: Uncomment the following lines when chisel support arch-specific
      # slices/dependencies
      # - erlang-base_bins
      # - erlang-inets_scripts
      # - erlang-os-mon_bins
      - grep_bins
      - libc-bin_locale
      - libc-bin_nsswitch
      - libtinfo6_libs
      - login_bins
      - netbase_default-hosts
      - netbase_default-networks
      - passwd_bins
      - python3.12_standard
      - rabbitmq-server_config
      - rabbitmq-server_modules
      - sed_bins
      - util-linux_su-support
    contents:
      /usr/bin/rabbitmqadmin:
      /usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server:
      /usr/lib/rabbitmq/bin/rabbitmq*:
      /usr/lib/rabbitmq/bin/vmware-rabbitmq:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/escript/rabbitmq-diagnostics:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/sbin/rabbitmq*:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/sbin/vmware-rabbitmq:
      # TODO: the files below are hardlinks
      # To be fixed when hardlinks are supported
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-plugins:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-queues:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-streams:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-upgrade:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmqctl:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/vmware-rabbitmq:
        copy: /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics
      /usr/sbin/rabbitmq*:
      /var/lib/rabbitmq/:
      # The following is a cookie file necessary for rabbitmq-server to work
      # The contents of that cookie file should be generated by the command:
      # openssl rand -base64 -out /var/lib/rabbitmq/.erlang.cookie 42
      /var/lib/rabbitmq/.erlang.cookie: { text: DUMMY, mode: 0400 }
      /var/lib/rabbitmq/mnesia/: { mode: 0750 }
      /var/log/rabbitmq/:

  config:
    contents:
      /etc/default/rabbitmq-server:
      /etc/rabbitmq/rabbitmq-env.conf:
        copy: /usr/share/rabbitmq/rabbitmq-env.conf
        mode: 0644

  modules:
    # TODO: Uncomment the following lines when chisel support arch-specific
    # slices/dependencies
    # essential:
    #   - erlang-crypto_modules
    #   - erlang-eldap_modules
    #   - erlang-mnesia_modules
    #   - erlang-parsetools_modules
    #   - erlang-public-key_modules
    #   - erlang-runtime-tools_modules
    #   - erlang-ssl_modules
    #   - erlang-syntax-tools_modules
    #   - erlang-tools_modules
    #   - erlang-xmerl_modules
    contents:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/plugins/**:

  copyright:
    contents:
      /usr/share/doc/rabbitmq-server/copyright:
