package: rabbitmq-server

essential:
  - rabbitmq-server_copyright

# erlang* packages do not exist for i386
## for all other archs, uncomment all those slices below
slices:
  autocomplete:
    contents:
      /usr/lib/rabbitmq/autocomplete/*:

  bins:
    essential:
      - base-files_base
      - base-passwd_data
      - bash_bins
      - coreutils_bins
      # - erlang-base_bins
      # - erlang-inets_scripts
      # - erlang-os-mon_bins
      - grep_bins
      - libc-bin_locale
      - libc-bin_nsswitch
      - libtinfo6_libs
      - login_bins
      - netbase_default-hosts
      - netbase_default-networks
      - passwd_bins
      - python3.12_standard
      - rabbitmq-server_libs
      - sed_bins
      - util-linux_su-only
    contents:
      /usr/bin/rabbitmqadmin:
      /usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server:
      /usr/lib/rabbitmq/bin/rabbitmq*:
      /usr/lib/rabbitmq/bin/vmware-rabbitmq:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/escript/rabbitmq-diagnostics:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/sbin/rabbitmq*:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/sbin/vmware-rabbitmq:
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-plugins:
        { mutable: true }
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-queues:
        { mutable: true }
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-streams:
        { mutable: true }
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-upgrade:
        { mutable: true }
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmqctl:
        { mutable: true }
      /usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/vmware-rabbitmq:
        { mutable: true }
      /usr/sbin/rabbitmq*:
      /var/lib/rabbitmq/:
      /var/lib/rabbitmq/.erlang.cookie: { text: DUMMY, mode: 0400 }
      /var/lib/rabbitmq/mnesia/: { mode: 0750 }
      /var/log/rabbitmq/:
    mutate: |
      file = content.read(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-diagnostics"
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-plugins",
        file
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-queues",
        file
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-streams",
        file
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmq-upgrade",
        file
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/rabbitmqctl",
        file
      )
      content.write(
        "/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.1/escript/vmware-rabbitmq",
        file
      )

  config:
    contents:
      /etc/default/rabbitmq-server:
      /etc/rabbitmq/rabbitmq-env.conf:
        { copy: /usr/share/rabbitmq/rabbitmq-env.conf, mode: 0644 }

  libs:
    essential:
      # - erlang-crypto_libs
      # - erlang-eldap_libs
      # - erlang-mnesia_libs
      # - erlang-parsetools_libs
      # - erlang-public-key_libs
      # - erlang-runtime-tools_libs
      # - erlang-ssl_libs
      # - erlang-syntax-tools_libs
      # - erlang-tools_libs
      # - erlang-xmerl_libs
      - rabbitmq-server_config
    contents:
      /usr/lib/rabbitmq/lib/rabbitmq_server-*/plugins/**:

  copyright:
    contents:
      /usr/share/doc/rabbitmq-server/copyright:
