summary: Integration tests for libnotify-bin

execute: |
  # liblerc4_libs required by libtiff6_libs on most architectures.
  # See: https://github.com/canonical/chisel-releases/blob/ubuntu-24.04/slices/libtiff6.yaml
  if [[ $(uname -m) == "s390x" ]] then
    rootfs="$(install-slices libnotify-bin_bins)"
  else
    rootfs="$(install-slices liblerc4_libs libnotify-bin_bins)"
  fi

  chroot "${rootfs}/" notify-send --help

  # Create a dbus UUID for the machine. The ID was generated on my machine with `dbus-uuidgen`
  mkdir -p "${rootfs}/var/lib/dbus"
  echo "09d781d32ff8502821328d1566c7a8a7" > "${rootfs}/var/lib/dbus/machine-id"
  ! chroot "${rootfs}/" notify-send "This will fail." 2| grep -q 'Cannot autolaunch D-Bus without X11 $DISPLAY'
