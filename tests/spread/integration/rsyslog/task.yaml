summary: Integration tests for rsyslog

execute: |
  rootfs="$(install-slices base-passwd_data base-files_base rsyslog_bins)"
  
  mkdir "${rootfs}"/proc
  mount --bind /proc ${rootfs}/proc
  
  mkdir "${rootfs}"/dev
  mount --bind /dev ${rootfs}/dev

  sed -i 's/^\($FileOwner[[:space:]]\+\)syslog/\1root/' "${rootfs}/etc/rsyslog.conf"
  sed -i 's/^\($PrivDropToUser[[:space:]]\+\)syslog/\1root/' "${rootfs}/etc/rsyslog.conf"
  sed -i 's/^\($PrivDropToGroup[[:space:]]\+\)syslog/\1root/' "${rootfs}/etc/rsyslog.conf"
  
  chroot ${rootfs} /usr/sbin/rsyslogd

  umount ${rootfs}/proc
  umount ${rootfs}/dev