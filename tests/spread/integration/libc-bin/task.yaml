summary: Integration tests for libc-bin

environment:
  SLICE/getconf: "getconf"
  SLICE/getent: "getent"

execute: |
  rootfs="$(install-slices libc-bin_${SLICE} )"

  case SLICE in
    getconf)
      chroot "$rootfs" getconf -a
    ;;
    getent)
      chroot "$rootfs" getent --version | grep -q getent
      chroot "${rootfs}" getent hosts
      ! chroot "${rootfs}" getent hosts localhost

      mkdir "${rootfs}/etc"
      echo "::1 localhost" > "${rootfs}/etc/hosts"
      chroot "${rootfs}" getent hosts localhost
    ;;
  esac
