summary: Integration tests for coreutils

prepare: |
  # Deb arch to GOARCH.
  arch="$(dpkg --print-architecture | sed -e 's/armhf/arm/g' -e 's/ppc64el/ppc64le/g')"
  # Install yq.
  wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_${arch} \
    -O /usr/bin/yq
  chmod +x /usr/bin/yq
  yq --version

execute: |
  # Run smoke tests.
  ./smoke.sh

  # Run single-binary slices tests
  # Forward port from 24.04

  # test env
  rootfs_env="$(install-slices coreutils_env)"
  chroot "$rootfs_env" env --version

  # test expr binary
  rootfs_expr="$(install-slices coreutils_expr)"
  chroot "$rootfs_expr" expr --version

  # test mkdir binary
  rootfs_mkdir="$(install-slices coreutils_mkdir)"
  chroot "$rootfs_mkdir" mkdir test_dir
  test -d "$rootfs_mkdir/test_dir"

  # test echo binary
  rootfs_echo="$(install-slices coreutils_echo)"
  chroot "$rootfs_echo" echo "Hello, World!"
