summary: Integration tests for systemd

execute: |
  # Chisel a minimum number of slices to give us a runnable system that we can
  # test in.
  rootfs="$(install-slices bash_bins coreutils_bins passwd_config base-files_base systemd_standard)"
  
  # systemd needs proc mounted
  mkdir "${rootfs}"/proc
  mount --bind /proc "${rootfs}"/proc

  cp test.sh "${rootfs}/"
  chroot "${rootfs}/" /test.sh

  umount "${rootfs}"/proc

  # Test just the detect-virt slice
  rootfs="$(install-slices systemd_detect-virt)"
  chroot "${rootfs}/" systemd-detect-virt --help
  chroot "${rootfs}/" systemd-detect-virt --list
