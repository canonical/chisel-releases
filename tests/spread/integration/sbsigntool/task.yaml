summary: Integration tests for sbsigntool

systems:
  - -ubuntu-24.04-ppc64le
  - -ubuntu-24.04-s390x

execute: |
  rootfs="$(install-slices sbsigntool_bins)"

  # create sign keys
  openssl req -nodes -new -x509 -newkey rsa:2048 -keyout MOK.priv -outform DER -out MOK.der -days 36500 -subj "/CN=Spread Test/"
  
  # copy the system mok keys
  cp ./MOK* "$rootfs"/
  echo "my test file" > "$rootfs"/test.ko

  # test kmodsign with a random file
  chroot "$rootfs" kmodsign sha512 /MOK.priv /MOK.der /test.ko
