summary: Integration tests for rust-1.84

execute: |
  rootfs="$(install-slices rustc-1.84_rustc)"

  chroot ${rootfs} rustc-1.84 --help
  chroot ${rootfs} rustc-1.84 --version | grep -q "rustc 1.84"

  # Test hello world
  arch=$(uname -m)-linux-gnu
  
  rootfs="$(install-slices \
    base-files_base \
    rustc-1.84_rustc \
    libgcc-14-dev_libs \
    gcc-14-$(echo $arch | sed 's/_/-/')_rustc-184-minimal \
  )"
  ln -s ${arch}-gcc-14 ${rootfs}/usr/bin/cc
  ln -s ${arch}-ld ${rootfs}/usr/bin/ld

  echo 'fn main() { println!("Hello from Rust!"); }' > ${rootfs}/hello.rs
  chroot ${rootfs} rustc-1.84 /hello.rs -o /hello
  chroot ${rootfs} /hello | grep -q "Hello from Rust!"